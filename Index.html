<!DOCTYPE html><html lang="en"class="dark"><head>  <meta charset="UTF-8">  <meta name="viewport"content="width=device-width, initial-scale=1.0">  <title>Driver's Hub</title>  <script src="https://cdn.tailwindcss.com"></script>  <link rel="preconnect"href="https://fonts.googleapis.com">  <link rel="preconnect"href="https://fonts.gstatic.com"crossorigin>  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap"rel="stylesheet">  <script src="https://unpkg.com/lucide@latest"></script>  <style>    /* Custom Styles &Theming Inspired by TransPennine Express */    :root {      --tpe-purple: #3a2c6b; /* Primary color */      --tpe-purple-light: rgba(58, 44, 107, 0.1);      --tpe-magenta: #e6007e; /* Accent color */            /* Set the primary color for the app */      --primary-color: var(--tpe-purple);      --primary-color-light: var(--tpe-purple-light);      --accent-color: var(--tpe-magenta);    }    body {      font-family: 'Montserrat', sans-serif;    }    /* Animation for content fading in */    .animate-fade-in {      animation: fade-in 0.5s ease-out forwards;    }    @keyframes fade-in {      from { opacity: 0; transform: translateY(10px); }      to { opacity: 1; transform: translateY(0); }    }    /* Custom scrollbar */    ::-webkit-scrollbar { width: 8px; }    ::-webkit-scrollbar-track { background: transparent; }    ::-webkit-scrollbar-thumb { background-color: rgba(100, 116, 139, 0.5); border-radius: 10px; }    .spinner {      border-color: #f3f3f3;      border-top-color: var(--accent-color);      animation: spin 1s linear infinite;    }    @keyframes spin {      to { transform: rotate(360deg); }    }    /* Use accent color for key buttons */    .btn-accent {      background-color: var(--accent-color);    }    .btn-accent:hover {      opacity: 0.9;    }    .ring-accent:hover {      ring-color: var(--accent-color);    }    /* Styles for quiz options */    .quiz-option.correct {      background-color: #10b981; /* Emerald 500 */      color: white;      border-color: #059669;    }    .quiz-option.incorrect {      background-color: #ef4444; /* Red 500 */      color: white;      border-color: #dc2626;    }  </style></head><body class="bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-200">  <div class="flex h-screen">    <!-- Sidebar Navigation -->    <nav id="sidebar"class="w-16 hover:w-64 fixed md:relative z-20 transition-all duration-300 ease-in-out bg-white dark:bg-slate-800/50 p-2 flex flex-col group shadow-lg h-full">      <div class="flex items-center space-x-4 p-2 mb-6">        <div class="rounded-lg flex-shrink-0 bg-[var(--primary-color-light)] p-2">          <svg role="img"class="h-6 w-6 text-[var(--primary-color)]"viewBox="0 0 24 24"fill="currentColor"><path d="M3.6 21.8c.4.2.8.2 1.2 0l15.6-8.4c.6-.3.9-.9.9-1.5s-.3-1.2-.9-1.5L4.8 2.1c-.4-.2-.8-.2-1.2 0C3 2.4 2.7 3 2.7 3.6v16.8c0 .6.3 1.2.9 1.4z"/></svg>        </div>        <h1 class="text-xl font-bold opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap">Driver's Hub</h1>      </div>      <ul id="nav-links"class="flex-1 space-y-2">        <!-- Nav items will be injected by JavaScript -->      </ul>      <div class="mt-auto space-y-2">        <a href="https://www.buymeacoffee.com"target="_blank"rel="noopener noreferrer"class="flex items-center space-x-4 p-2 rounded-lg transition-colors hover:bg-slate-200 dark:hover:bg-slate-700">          <i data-lucide="coffee"class="h-6 w-6 flex-shrink-0"></i>          <span class="opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap">Buy me a brew</span>        </a>        <a href="#"data-view="settings"class="nav-link flex items-center space-x-4 p-2 rounded-lg transition-colors hover:bg-slate-200 dark:hover:bg-slate-700">          <i data-lucide="settings"class="h-6 w-6 flex-shrink-0"></i>          <span class="opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap">Settings</span>        </a>      </div>    </nav>    <!-- Main Content Area -->    <div class="flex-1 flex flex-col min-w-0">      <header class="bg-white/80 dark:bg-slate-800/50 backdrop-blur-sm p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between sticky top-0 z-10">        <h2 id="header-title"class="text-2xl font-bold text-slate-900 dark:text-white">Dashboard</h2>        <div class="flex items-center space-x-4">          <div class="relative w-64">            <i data-lucide="search"class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-400"></i>            <input id="search-input"type="search"placeholder="Global search..."class="w-full pl-10 pr-4 py-2 rounded-lg bg-slate-100 dark:bg-slate-700 border border-transparent focus:ring-2 focus:ring-[var(--accent-color)] transition"/>          </div>        </div>      </header>      <main id="content-container"class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto">        <!-- Content will be injected by JavaScript -->      </main>    </div>  </div>    <!-- Modal Container -->  <div id="modal-container"class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 hidden">    <div id="modal-content"class="bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] flex flex-col animate-fade-in">      <header class="p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between">        <h3 id="modal-title"class="text-xl font-bold text-slate-900 dark:text-white">Document</h3>        <button id="modal-close-btn"class="p-1 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">          <i data-lucide="x"class="h-6 w-6"></i>        </button>      </header>      <div id="modal-body"class="p-6 overflow-y-auto"></div>      <footer class="p-4 border-t border-slate-200 dark:border-slate-700 flex justify-end items-center space-x-4">        <button class="flex items-center space-x-2 px-4 py-2 text-sm font-semibold rounded-lg bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 transition-colors">          <i data-lucide="download"class="h-4 w-4"></i>          <span>Save Offline</span>        </button>        <button class="flex items-center space-x-2 px-4 py-2 text-sm font-semibold rounded-lg bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 transition-colors">          <i data-lucide="edit"class="h-4 w-4"></i>          <span>Suggest an Edit</span>        </button>      </footer>    </div>  </div>  <script>    document.addEventListener('DOMContentLoaded', () =>{      // --- DATA STORE ---      const appData = {        manuals: [          { id: 'M1', title: 'Class 390 "Pendolino"Manual', category: 'Electric Multiple Units', version: '4.2', content: 'Full operational guide for the Class 390 Pendolino, covering systems, fault finding, and emergency procedures.' },          { id: 'M2', title: 'Route Knowledge: WCML South', category: 'Route Guides', version: '2.1', content: 'Detailed route guide for the West Coast Main Line, London Euston to Birmingham New Street.' },        ],        safetyDocuments: [ { id: 'S1', title: 'Personal Track Safety (PTS) Handbook', version: '8.0', summary: 'Essential rules and procedures for anyone working on or near the line.' } ],        ruleBooks: [ { id: 'RB1', title: 'GE/RT8000 - The Rule Book', version: 'Master v12.4', summary: 'The definitive guide to railway operations, signals, and procedures in the UK.' } ],        termsAndConditions: [ { id: 'TC1', title: 'Driver Terms of Service', version: '3.0', summary: 'Official terms and conditions for all driving staff.' } ],        qanda: [ { id: 'Q1', question: 'What is the procedure for a SPAD?', answer: 'Immediately bring the train to a stand, do not move, and contact the signaller.', category: 'Emergency Procedures' } ],        videos: [ { id: 'V1', title: 'Defensive Driving Techniques', url: 'https://www.youtube.com/embed/dQw4w9WgXcQ', description: 'A deep dive into hazard perception and defensive driving strategies.' } ],        usefulLinks: [          { id: 'L1', title: 'RSSB (Rail Safety and Standards Board)', url: 'https://www.rssb.co.uk', description: 'The main body for rail safety standards in the UK.' },          { id: 'L2', title: 'Network Rail Safety Central', url: 'https://safety.networkrail.co.uk/', description: 'Safety briefings, videos, and resources from Network Rail.' },        ],        bitesizeRules: [          {            id: 'R1',            title: 'AWS &TPWS',            explanation: 'The Automatic Warning System (AWS) provides an audible and visual warning of an upcoming signal. The Train Protection &Warning System (TPWS) can automatically apply the brakes if a train passes a signal at danger or over-speeds.',            quiz: [              { q: 'What does AWS stand for?', options: ['Automatic Warning System', 'Advanced Warning Signal', 'Automated Waypoint System'], answer: 0 },              { q: 'What is the primary function of TPWS?', options: ['To warn the driver', 'To automatically apply brakes', 'To communicate with the signaller'], answer: 1 }            ]          }        ],        psychometricTests: [          { id: 'P1', title: 'Situational Judgement', description: 'Read the scenario and choose the most effective response.', scenario: 'You notice a passenger drop a bag on the platform as the doors are closing. What is your immediate action?', options: ['Re-open the doors.', 'Inform the signaller and platform staff immediately.', 'Ignore it as the train is departing.', 'Make a passenger announcement.'], answer: 1 }        ]      };      // --- APP STATE ---      let activeView = 'dashboard';      // --- UI ELEMENT REFERENCES ---      const contentContainer = document.getElementById('content-container');      const headerTitle = document.getElementById('header-title');      const navLinksContainer = document.getElementById('nav-links');      const searchInput = document.getElementById('search-input');      const modalContainer = document.getElementById('modal-container');      const modalTitle = document.getElementById('modal-title');      const modalBody = document.getElementById('modal-body');      const modalCloseBtn = document.getElementById('modal-close-btn');      // --- NAVIGATION ITEMS (CORRECTED &COMPLETE) ---      const navItems = [        { id: 'dashboard', icon: 'layout-dashboard', label: 'Dashboard' },        { id: 'traction', icon: 'train-track', label: 'Traction' },        { id: 'safety', icon: 'shield-check', label: 'Safety Docs' },        { id: 'ruleBooks', icon: 'book-open', label: 'Rule Book' },        { id: 'terms', icon: 'book-lock', label: "Driver's T&Cs"},        { id: 'maps', icon: 'map', label: 'Route Maps' },        { id: 'videos', icon: 'play-circle', label: 'Videos' },        { id: 'qanda', icon: 'help-circle', label: 'Q&A' },        { id: 'traineeZone', icon: 'graduation-cap', label: 'Trainee Zone' },        { id: 'links', icon: 'link', label: 'Useful Links' },        { id: 'ai', icon: 'brain-circuit', label: 'AI Assistant' },      ];      // --- RENDER FUNCTIONS ---      const renderView = (viewId) =>{        activeView = viewId;        contentContainer.innerHTML = '';                 const viewTitle = navItems.find(n =>n.id === viewId)?.label || 'Dashboard';        headerTitle.textContent = viewTitle;        switch (viewId) {          case 'dashboard':            contentContainer.innerHTML = `<div class="space-y-8 animate-fade-in"><div><h2 class="text-3xl font-bold mb-2">Welcome Back, Driver</h2><p class="text-slate-500 dark:text-slate-400">Your central hub for safe and efficient operations.</p></div></div>`;            break;          case 'traction':          case 'safety':          case 'ruleBooks':          case 'terms':          case 'qanda':            const collectionMap = {              traction: 'manuals',              safety: 'safetyDocuments',              ruleBooks: 'ruleBooks',              terms: 'termsAndConditions',              qanda: 'qanda'            };            const collectionKey = collectionMap[viewId];            const data = appData[collectionKey] || [];            contentContainer.innerHTML = `<div class="animate-fade-in grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">${data.map(item =>createCardHTML({...item, collection: collectionKey})).join('')}</div>`;            break;          case 'videos':            contentContainer.innerHTML = `<div class="grid grid-cols-1 md:grid-cols-2 gap-8 animate-fade-in">${appData.videos.map(video =>`<div class="bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden"><div class="aspect-video"><iframe class="w-full h-full"src="${video.url}"title="${video.title}"frameborder="0"allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"allowfullscreen></iframe></div><div class="p-5"><h3 class="text-lg font-bold">${video.title}</h3><p class="text-sm text-slate-500 dark:text-slate-400 mt-1">${video.description}</p></div></div>`).join('')}</div>`;            break;          case 'links':            contentContainer.innerHTML = `<div class="space-y-4 animate-fade-in">${appData.usefulLinks.map(link =>`<a href="${link.url}"target="_blank"rel="noopener noreferrer"class="block bg-white dark:bg-slate-800 p-5 rounded-xl shadow-md hover:shadow-lg hover:ring-2 ring-accent transition-all"><h3 class="text-lg font-bold text-[var(--primary-color)]">${link.title}</h3><p class="text-sm text-slate-500 dark:text-slate-400 mt-1">${link.description}</p></a>`).join('')}</div>`;            break;          case 'ai':            renderAIAssistant();            break;          case 'traineeZone':            renderTraineeZone();            break;          case 'settings':            contentContainer.innerHTML = `<div class="max-w-2xl mx-auto p-8 bg-white dark:bg-slate-800 rounded-xl shadow-md space-y-8 animate-fade-in"><div><h3 class="text-lg font-semibold mb-3">Theme</h3><div class="flex space-x-4"><button data-theme="light"class="theme-btn flex-1 p-4 rounded-lg border-2 bg-slate-100"><i data-lucide="sun"class="mx-auto h-8 w-8 text-slate-600"></i><p class="text-center mt-2 font-semibold text-slate-700">Light</p></button><button data-theme="dark"class="theme-btn flex-1 p-4 rounded-lg border-2 bg-slate-700"><i data-lucide="moon"class="mx-auto h-8 w-8 text-slate-200"></i><p class="text-center mt-2 font-semibold text-slate-200">Dark</p></button></div></div></div>`;            break;          default:            contentContainer.innerHTML = `<div class="text-center p-8 bg-white dark:bg-slate-800 rounded-xl shadow-md animate-fade-in"><h3 class="text-2xl font-bold mb-2">Coming Soon</h3><p class="text-slate-500">This section is under construction.</p></div>`;        }        updateNavLinks();        lucide.createIcons();      };            const renderTraineeZone = () =>{        contentContainer.innerHTML = `          <div class="space-y-8 animate-fade-in">            <div><h2 class="text-3xl font-bold mb-2">Trainee Zone</h2><p class="text-slate-500 dark:text-slate-400">Tools and resources to support your training journey.</p></div>            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">              <button data-tool="rules"class="trainee-tool-btn bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md hover:shadow-lg hover:-translate-y-1 transition-all text-left"><h3 class="text-lg font-semibold">Bitesize Rule Book</h3><p class="text-sm text-slate-500">Learn key rules with simple quizzes.</p></button>              <button data-tool="psychometric"class="trainee-tool-btn bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md hover:shadow-lg hover:-translate-y-1 transition-all text-left"><h3 class="text-lg font-semibold">Psychometric Simulators</h3><p class="text-sm text-slate-500">Practice for your assessments.</p></button>              <button data-tool="routes"class="trainee-tool-btn bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md hover:shadow-lg hover:-translate-y-1 transition-all text-left"><h3 class="text-lg font-semibold">Route Videos</h3><p class="text-sm text-slate-500">Interactive hazard perception.</p></button>            </div>          </div>`;      };            const renderTraineeTool = (tool) =>{        let content = '';        switch(tool) {          case 'rules':            const rule = appData.bitesizeRules[0];            content = `<div class="max-w-2xl mx-auto bg-white dark:bg-slate-800 rounded-xl shadow-md p-6"><h3 class="text-2xl font-bold">${rule.title}</h3><p class="mt-2 text-slate-600 dark:text-slate-300">${rule.explanation}</p><div id="quiz-container"class="mt-6 space-y-4">${rule.quiz.map((q, index) =>`<div class="quiz-question"data-question-index="${index}"><p class="font-semibold">${q.q}</p><div class="mt-2 space-y-2">${q.options.map((opt, optIndex) =>`<button class="quiz-option w-full text-left p-3 border rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700"data-option-index="${optIndex}">${opt}</button>`).join('')}</div></div>`).join('')}</div></div>`;            break;          case 'psychometric':            const test = appData.psychometricTests[0];            content = `<div class="max-w-2xl mx-auto bg-white dark:bg-slate-800 rounded-xl shadow-md p-6"><h3 class="text-2xl font-bold">${test.title}</h3><p class="mt-2 text-slate-600 dark:text-slate-300">${test.description}</p><div class="mt-4 p-4 bg-slate-100 dark:bg-slate-700 rounded-lg"><p class="font-mono">${test.scenario}</p></div><div id="sjt-options"class="mt-4 space-y-2">${test.options.map((opt, index) =>`<button class="quiz-option w-full text-left p-3 border rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700"data-option-index="${index}">${opt}</button>`).join('')}</div></div>`;            break;          case 'routes':            content = `<div class="max-w-4xl mx-auto bg-white dark:bg-slate-800 rounded-xl shadow-md"><div class="aspect-video"><iframe class="w-full h-full"src="https://www.youtube.com/embed/uG-aD0-z-J4"title="UK Cab Ride"frameborder="0"allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"allowfullscreen></iframe></div><div class="p-6 text-center"><button id="hazard-btn"class="px-8 py-4 text-lg font-bold text-white bg-red-600 rounded-full hover:bg-red-700 transition-transform transform active:scale-95"><i data-lucide="alert-triangle"class="inline-block mr-2"></i>SPOT HAZARD</button><p id="hazard-feedback"class="mt-4 h-6 text-slate-500"></p></div></div>`;            break;        }        contentContainer.innerHTML = `<div class="animate-fade-in">${content}</div>`;        lucide.createIcons();      };      const renderAIAssistant = () =>{        const allDocs = [ ...appData.manuals, ...appData.safetyDocuments, ...appData.ruleBooks ];        contentContainer.innerHTML = `<div class="max-w-4xl mx-auto bg-white dark:bg-slate-800 rounded-xl shadow-md animate-fade-in"><div class="p-6 border-b border-slate-200 dark:border-slate-700"><h3 class="text-xl font-bold">AI Learning Assistant</h3><p class="text-sm text-slate-500 mt-1">Select a document and ask a question.</p></div><div class="p-6 space-y-4"><div><label for="ai-doc-selector"class="block text-sm font-medium mb-1">1. Select Document</label><select id="ai-doc-selector"class="w-full p-2 bg-slate-100 dark:bg-slate-700 rounded-lg"><option value="">-- Choose --</option>${allDocs.map(doc =>`<option value="${doc.id}">${doc.title}</option>`).join('')}</select></div><textarea id="ai-context"rows="8"class="w-full p-2 bg-slate-100 dark:bg-slate-700 rounded-lg resize-y hidden"></textarea><div><label for="ai-question"class="block text-sm font-medium mb-1">2. Ask a Question</label><input type="text"id="ai-question"placeholder="e.g., What are the key safety steps?"class="w-full p-2 bg-slate-100 dark:bg-slate-700 rounded-lg"/></div><button id="ai-submit-btn"class="w-full px-4 py-3 font-semibold text-white btn-accent rounded-lg flex items-center justify-center space-x-2"><span>Get Answer</span></button></div><div id="ai-answer-container"class="p-6 border-t border-slate-200 dark:border-slate-700"><h4 class="font-semibold">Answer:</h4><div id="ai-answer"class="mt-2 text-slate-600 dark:text-slate-300">The AI's response will appear here.</div></div></div>`;      };      // --- EVENT LISTENERS &LOGIC ---      contentContainer.addEventListener('click', (e) =>{        const toolBtn = e.target.closest('.trainee-tool-btn');        if (toolBtn) { renderTraineeTool(toolBtn.dataset.tool); }        const quizOption = e.target.closest('.quiz-question .quiz-option');        if (quizOption) {          const questionDiv = quizOption.parentElement.parentElement;          const questionIndex = parseInt(questionDiv.dataset.questionIndex);          const optionIndex = parseInt(quizOption.dataset.optionIndex);          const isCorrect = appData.bitesizeRules[0].quiz[questionIndex].answer === optionIndex;          questionDiv.querySelectorAll('.quiz-option').forEach(btn =>btn.disabled = true);          quizOption.classList.add(isCorrect ? 'correct' : 'incorrect');          if (!isCorrect) { questionDiv.querySelector(`[data-option-index="${appData.bitesizeRules[0].quiz[questionIndex].answer}"]`).classList.add('correct'); }        }                const sjtOption = e.target.closest('#sjt-options .quiz-option');        if (sjtOption) {          const optionIndex = parseInt(sjtOption.dataset.optionIndex);          const isCorrect = appData.psychometricTests[0].answer === optionIndex;          document.querySelectorAll('#sjt-options .quiz-option').forEach(btn =>btn.disabled = true);          sjtOption.classList.add(isCorrect ? 'correct' : 'incorrect');          if (!isCorrect) { document.querySelector(`#sjt-options [data-option-index="${appData.psychometricTests[0].answer}"]`).classList.add('correct'); }        }        const hazardBtn = e.target.closest('#hazard-btn');        if (hazardBtn) {          const feedback = document.getElementById('hazard-feedback');          feedback.textContent = 'Hazard spotted!';          setTimeout(() =>feedback.textContent = '', 2000);        }                const viewBtn = e.target.closest('.view-details-btn');        if (viewBtn) { openModal(viewBtn.dataset.collection, viewBtn.dataset.id); }        const themeBtn = e.target.closest('.theme-btn');        if(themeBtn) { document.documentElement.className = themeBtn.dataset.theme; }        const aiSubmitBtn = e.target.closest('#ai-submit-btn');        if(aiSubmitBtn) { handleAIAssistant(); }        const docSelector = e.target.closest('#ai-doc-selector');        if (docSelector) {          const allDocs = [ ...appData.manuals, ...appData.safetyDocuments, ...appData.ruleBooks ];          const selectedDoc = allDocs.find(d =>d.id === docSelector.value);          document.getElementById('ai-context').value = selectedDoc ? (selectedDoc.content || selectedDoc.summary || '') : '';        }      });      // --- INITIALIZATION &HELPERS ---      const init = () =>{ renderView('dashboard'); };      const createCardHTML = (item) =>`<div class="bg-white dark:bg-slate-800 p-5 rounded-xl shadow-md flex flex-col"><h3 class="text-lg font-bold mb-2">${item.title || item.question}</h3><p class="text-sm text-slate-500 dark:text-slate-400 flex-1 mb-4">${item.summary || item.category || `Version: ${item.version}`}</p><button data-collection="${item.collection}"data-id="${item.id}"class="view-details-btn mt-auto w-full px-4 py-2 font-semibold text-white btn-accent rounded-lg transition-opacity">View Details</button></div>`;      const openModal = (collection, id) =>{ const item = appData[collection].find(i =>i.id === id); if (!item) return; modalTitle.textContent = item.title || item.question; modalBody.innerHTML = `<p class="text-slate-600 dark:text-slate-300 whitespace-pre-wrap">${item.content || item.summary || item.answer}</p>`; modalContainer.classList.remove('hidden'); };      const closeModal = () =>modalContainer.classList.add('hidden');      const handleAIAssistant = async () =>{ const contextEl = document.getElementById('ai-context'); const questionEl = document.getElementById('ai-question'); const answerEl = document.getElementById('ai-answer'); const submitBtn = document.getElementById('ai-submit-btn'); const context = contextEl.value; const question = questionEl.value; const API_KEY = "AIzaSyAoX09BIHBm7a66nhV4MpYn47Gqp34KnDY"; if (!context.trim() || !question.trim()) { answerEl.textContent = "Please provide both document context and a question."; return; } submitBtn.disabled = true; submitBtn.innerHTML = `<div class="spinner w-5 h-5 border-2 rounded-full"></div><span>Analyzing...</span>`; answerEl.innerHTML = 'Thinking...'; const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`; const prompt = `Based on the following document context, please answer the user's question. Context: "${context}". Question: "${question}"`; try { const response = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) }); if (!response.ok) { const errorData = await response.json(); throw new Error(`API Error (${response.status}): ${errorData.error.message}`); } const result = await response.json(); const text = result.candidates[0].content.parts[0].text; answerEl.textContent = text; } catch (error) { console.error("AI Assistant Error:", error); answerEl.innerHTML = `<p class="text-red-500"><strong>Error:</strong>Could not get an answer. ${error.message}</p>`; } finally { submitBtn.disabled = false; submitBtn.innerHTML = `<span>Get Answer</span>`; } };      const updateNavLinks = () =>{ navLinksContainer.innerHTML = navItems.map(item =>`<li><a href="#"data-view="${item.id}"class="nav-link flex items-center space-x-4 p-2 rounded-lg transition-colors ${activeView === item.id ? 'bg-[var(--primary-color-light)] text-[var(--primary-color)] font-semibold' : 'hover:bg-slate-200 dark:hover:bg-slate-700'}"><i data-lucide="${item.icon}"class="h-6 w-6 flex-shrink-0"></i><span class="opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap">${item.label}</span></a></li>`).join(''); lucide.createIcons(); };      const renderSearchResults = (query) =>{ headerTitle.textContent = `Search Results for "${query}"`; const lowerQuery = query.toLowerCase(); let resultsHTML = ''; Object.keys(appData).forEach(collection =>{ if (Array.isArray(appData[collection])) { const results = appData[collection].filter(item =>JSON.stringify(item).toLowerCase().includes(lowerQuery)); if (results.length >0) { resultsHTML += results.map(item =>createCardHTML({...item, collection})).join(''); } } }); if (!resultsHTML) { resultsHTML = `<p>No results found for "${query}".</p>`; } contentContainer.innerHTML = `<div class="animate-fade-in grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">${resultsHTML}</div>`; lucide.createIcons(); };      searchInput.addEventListener('input', (e) =>{ const query = e.target.value; if (query.length >1) { renderSearchResults(query); } else if (query.length === 0) { renderView(activeView); } });      modalCloseBtn.addEventListener('click', closeModal);      modalContainer.addEventListener('click', (e) =>{ if (e.target === modalContainer) closeModal(); });            init();    });  </script></body></html>
